<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Published Scenarios</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#003366',
                        secondary: '#0055A5',
                        lightbg: '#E6F0FA'
                    }
                }
            }
        }
    </script>

    <!-- Dark mode toggle -->
    <script>
        window.onload = () => {
            document.documentElement.classList.remove('dark');
        };
        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
        }
    </script>
</head>

<body class="bg-lightbg dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen font-sans">

<!-- Header -->
<header class="bg-primary dark:bg-gray-800 shadow fixed w-full top-0 z-10">
    <div class="flex items-center justify-between px-6 py-4">
        <div class="flex items-center space-x-3">
            <img src="/images/800px-Tai_logo.png" alt="TUSA≈û Logo" class="h-10" />
        </div>
        <div class="space-x-4 flex items-center">
            <!-- üîç Live Search -->
            <input id="searchInput" type="text" placeholder="Search trends or scenarios..."
                   class="px-3 py-1 rounded border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
                   oninput="filterScenarios()" />
            <button onclick="toggleDarkMode()"
                    class="bg-blue-100 dark:bg-gray-700 px-3 py-1 rounded text-sm">
                Toggle Dark Mode
            </button>
        </div>
    </div>
</header>

<!-- Sidebar + Content -->
<div class="flex pt-16">

    <!-- Sidebar -->
    <aside class="w-64 bg-primary text-white min-h-screen fixed dark:bg-gray-800">
        <div class="p-6">
            <ul class="space-y-4">
                <li><a href="/panel" class="hover">Technology Radar</a></li>
                <li><a href="/published-scenarios" class="font-bold">Published Scenarios</a></li>
                <li><a href="/radar" class="hover">Defence</a></li>
                <li><a href="/radar" class="hover">Aviation</a></li>
            </ul>

        </div>
    </aside>

    <!-- Main Content -->
    <main class="ml-64 w-full p-8">
        <h1 class="text-3xl font-bold mb-8 text-gray-800 dark:text-gray-100">Published Scenarios</h1>

        <!-- Scenario Cards -->
        <div id="scenarioContainer">
            <div th:each="scenario : ${scenarios}" class="scenario-card mb-10 bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
                <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-100 mb-2"
                    th:text="${scenario.trend.trendName}">Scenario Title</h2>
                <p class="text-gray-600 dark:text-gray-300 mb-4" th:text="${scenario.scenarioText}">Scenario description...</p>

                <!-- Date -->
                <p class="text-sm text-gray-400 mb-6"
                   th:text="${T(java.time.format.DateTimeFormatter).ofPattern('dd MMM yyyy').format(scenario.updatedAt)}">Date</p>

                <!-- Comments -->
                <div>
                    <h3 class="text-lg font-semibold mb-4">Comments</h3>
                    <div th:if="${scenario.comments.empty}" class="text-gray-500 italic">No comments yet.</div>

                    <div th:each="comment : ${scenario.comments}" class="mb-4 border rounded-lg p-4 bg-gray-50 dark:bg-gray-700">
                        <div class="flex items-center mb-2">
                            <!-- Avatar -->
                            <div class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center mr-2">
                                <span th:text="${#strings.substring(comment.user.getFirstName()+comment.user.getLastName(), 0, 1)}">U</span>
                            </div>
                            <p class="font-medium text-gray-800 dark:text-white" th:text="${comment.user.getFirstName()+comment.user.getLastName()}">Username</p>
                        </div>
                        <p class="text-gray-600 dark:text-gray-200" th:text="${comment.text}">Comment content here.</p>
                        <div class="flex items-center justify-between mt-2">
                            <p class="text-sm text-gray-400"
                               th:text="${T(java.time.format.DateTimeFormatter).ofPattern('dd MMM yyyy').format(comment.createdAt)}">
                                01 Jan 2024
                            </p>
                            <button class="text-sm text-blue-600 dark:text-blue-400 hover:underline">üëç Like</button>
                        </div>
                    </div>

                    <!-- Comment Form -->
                    <form th:action="@{'/api/scenario/' + ${scenario.id} + '/comment'}" method="post" class="mt-6 space-y-4">
                        <!-- Avatar + User Name (From Session) -->
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 rounded-full bg-blue-600 text-white flex items-center justify-center text-lg font-semibold">
                                <span th:text="${#strings.substring(userName, 0, 1)}">U</span>
                            </div>
                            <span class="font-medium text-gray-800 dark:text-white" th:text="${userName}">Current User</span>
                        </div>

                        <!-- Comment Box -->
                        <textarea name="content" placeholder="Write your comment..." rows="3"
                                  class="w-full p-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-white rounded-md resize-none"
                                  required></textarea>

                        <button type="submit"
                                class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md font-semibold">
                            Submit Comment
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- üîç Live Search Script -->
<script>
    function filterScenarios() {
        const input = document.getElementById("searchInput").value.toLowerCase();
        const cards = document.querySelectorAll(".scenario-card");

        cards.forEach(card => {
            const title = card.querySelector("h2").innerText.toLowerCase();
            const desc = card.querySelector("p").innerText.toLowerCase();

            if (title.includes(input) || desc.includes(input)) {
                card.style.display = "block";
            } else {
                card.style.display = "none";
            }
        });
    }
</script>

</body>
</html>
